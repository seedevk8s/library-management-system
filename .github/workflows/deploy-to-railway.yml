name: Deploy to Railway

# ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° ì¡°ê±´
on:
  push:
    branches:
      - main
      - claude/deploy-to-aws-011CV5PvDYXxRMgE1vDEaxCo  # í˜„ìž¬ ìž‘ì—… ë¸Œëžœì¹˜
  workflow_dispatch:  # GitHub UIì—ì„œ ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

# ì›Œí¬í”Œë¡œìš° ì „ì²´ì—ì„œ ì‚¬ìš©í•  í™˜ê²½ ë³€ìˆ˜
env:
  RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

jobs:
  deploy:
    name: Deploy to Railway
    runs-on: ubuntu-latest
    environment: production

    steps:
      # Step 1: ì†ŒìŠ¤ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Railway CLI ì„¤ì¹˜
      - name: Install Railway CLI
        run: |
          # Railway CLI ìµœì‹  ë²„ì „ ì„¤ì¹˜
          curl -fsSL https://railway.app/install.sh | sh
          echo "$HOME/.railway/bin" >> $GITHUB_PATH

      # Step 3: Railway CLI ë²„ì „ í™•ì¸
      - name: Verify Railway CLI installation
        run: railway version

      # Step 4: Railwayì— ë°°í¬
      - name: Deploy to Railway
        run: |
          # Railway í† í°ìœ¼ë¡œ ì¸ì¦
          echo "ðŸ” Authenticating with Railway..."

          # Railway í”„ë¡œì íŠ¸ì— ë°°í¬
          echo "ðŸš€ Deploying to Railway..."
          railway up --detach

          echo "âœ… Deployment initiated successfully!"
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}

      # Step 5: ë°°í¬ ê²°ê³¼ ìš”ì•½
      - name: Deployment Summary
        run: |
          echo "### ðŸš€ Railway Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Commit**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Triggered by**: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Deployment to Railway completed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— Check your deployment status at: https://railway.app" >> $GITHUB_STEP_SUMMARY
