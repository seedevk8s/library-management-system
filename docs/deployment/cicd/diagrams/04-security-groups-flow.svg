<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 800">
  <defs>
    <style>
      .sg-box { stroke: #333; stroke-width: 3; }
      .sg-alb { fill: #8C4FFF; }
      .sg-ecs { fill: #FF7A00; }
      .sg-rds { fill: #00758F; }
      .component { fill: #fff; stroke: #666; stroke-width: 2; }
      .user { fill: #3498DB; stroke: #2980B9; stroke-width: 2; }
      .text-white { fill: #fff; font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
      .text-title { fill: #333; font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; }
      .text-desc { fill: #666; font-family: Arial, sans-serif; font-size: 12px; }
      .arrow { fill: none; stroke-width: 4; }
      .arrow-red { stroke: #E74C3C; }
      .arrow-orange { stroke: #FF8C00; }
      .arrow-blue { stroke: #3498DB; }
    </style>
    <marker id="arrow-red" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#E74C3C" />
    </marker>
    <marker id="arrow-orange" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#FF8C00" />
    </marker>
    <marker id="arrow-blue" markerWidth="12" markerHeight="12" refX="10" refY="3" orient="auto">
      <polygon points="0 0, 12 3, 0 6" fill="#3498DB" />
    </marker>
  </defs>
  
  <text x="700" y="40" text-anchor="middle" class="text-title" style="font-size: 28px;">
    🔐 Security Groups 트래픽 흐름도
  </text>
  <text x="700" y="70" text-anchor="middle" class="text-desc" style="font-size: 16px;">
    각 보안 그룹의 역할과 트래픽 허용 규칙
  </text>
  
  <!-- Internet Users -->
  <ellipse cx="120" cy="250" rx="80" ry="60" class="user"/>
  <text x="120" y="240" text-anchor="middle" style="font-size: 36px; fill: #fff;">🌐</text>
  <text x="120" y="270" text-anchor="middle" class="text-white">Internet</text>
  <text x="120" y="290" text-anchor="middle" style="font-size: 12px; fill: #fff;">Users</text>
  
  <!-- Security Group 1: ALB -->
  <g transform="translate(280, 150)">
    <rect width="280" height="200" class="sg-box sg-alb" rx="15"/>
    <text x="140" y="35" text-anchor="middle" class="text-white" style="font-size: 18px;">
      Security Group #1
    </text>
    <text x="140" y="60" text-anchor="middle" class="text-white" style="font-size: 16px;">
      library-alb-sg
    </text>
    
    <!-- ALB Component -->
    <rect x="40" y="80" width="200" height="80" class="component" rx="8"/>
    <text x="140" y="110" text-anchor="middle" style="font-size: 14px; fill: #000; font-weight: bold;">
      Application Load Balancer
    </text>
    <text x="140" y="130" text-anchor="middle" style="font-size: 12px; fill: #666;">
      (ALB)
    </text>
    <text x="140" y="150" text-anchor="middle" style="font-size: 11px; fill: #666;">
      Port: 80, 443
    </text>
    
    <!-- Inbound Rules -->
    <text x="10" y="185" style="font-size: 11px; fill: #fff; font-weight: bold;">Inbound:</text>
    <text x="10" y="200" style="font-size: 10px; fill: #fff;">✓ HTTP (80) ← 0.0.0.0/0</text>
    <text x="10" y="215" style="font-size: 10px; fill: #fff;">✓ HTTPS (443) ← 0.0.0.0/0</text>
  </g>
  
  <!-- Arrow 1: Internet to ALB -->
  <path d="M 200 250 L 280 250" class="arrow arrow-red" marker-end="url(#arrow-red)"/>
  <text x="240" y="240" text-anchor="middle" style="font-size: 13px; fill: #E74C3C; font-weight: bold;">
    HTTP/HTTPS
  </text>
  <text x="240" y="255" text-anchor="middle" style="font-size: 11px; fill: #E74C3C;">
    Port 80, 443
  </text>
  
  <!-- Security Group 2: ECS -->
  <g transform="translate(640, 150)">
    <rect width="280" height="200" class="sg-box sg-ecs" rx="15"/>
    <text x="140" y="35" text-anchor="middle" class="text-white" style="font-size: 18px;">
      Security Group #2
    </text>
    <text x="140" y="60" text-anchor="middle" class="text-white" style="font-size: 16px;">
      library-ecs-task-sg
    </text>
    
    <!-- ECS Component -->
    <rect x="40" y="80" width="200" height="80" class="component" rx="8"/>
    <text x="140" y="110" text-anchor="middle" style="font-size: 14px; fill: #000; font-weight: bold;">
      ECS Tasks
    </text>
    <text x="140" y="130" text-anchor="middle" style="font-size: 12px; fill: #666;">
      (Spring Boot App)
    </text>
    <text x="140" y="150" text-anchor="middle" style="font-size: 11px; fill: #666;">
      Port: 8081
    </text>
    
    <!-- Inbound Rules -->
    <text x="10" y="185" style="font-size: 11px; fill: #fff; font-weight: bold;">Inbound:</text>
    <text x="10" y="200" style="font-size: 10px; fill: #fff;">✓ TCP 8081 ← library-alb-sg</text>
  </g>
  
  <!-- Arrow 2: ALB to ECS -->
  <path d="M 560 250 L 640 250" class="arrow arrow-orange" marker-end="url(#arrow-orange)"/>
  <text x="600" y="240" text-anchor="middle" style="font-size: 13px; fill: #FF8C00; font-weight: bold;">
    HTTP
  </text>
  <text x="600" y="255" text-anchor="middle" style="font-size: 11px; fill: #FF8C00;">
    Port 8081
  </text>
  
  <!-- Security Group 3: RDS -->
  <g transform="translate(1000, 150)">
    <rect width="280" height="200" class="sg-box sg-rds" rx="15"/>
    <text x="140" y="35" text-anchor="middle" class="text-white" style="font-size: 18px;">
      Security Group #3
    </text>
    <text x="140" y="60" text-anchor="middle" class="text-white" style="font-size: 16px;">
      library-rds-sg
    </text>
    
    <!-- RDS Component -->
    <rect x="40" y="80" width="200" height="80" class="component" rx="8"/>
    <text x="140" y="110" text-anchor="middle" style="font-size: 14px; fill: #000; font-weight: bold;">
      RDS MySQL
    </text>
    <text x="140" y="130" text-anchor="middle" style="font-size: 12px; fill: #666;">
      (Database)
    </text>
    <text x="140" y="150" text-anchor="middle" style="font-size: 11px; fill: #666;">
      Port: 3306
    </text>
    
    <!-- Inbound Rules -->
    <text x="10" y="185" style="font-size: 11px; fill: #fff; font-weight: bold;">Inbound:</text>
    <text x="10" y="200" style="font-size: 10px; fill: #fff;">✓ MySQL 3306 ← library-ecs-task-sg</text>
  </g>
  
  <!-- Arrow 3: ECS to RDS -->
  <path d="M 920 250 L 1000 250" class="arrow arrow-blue" marker-end="url(#arrow-blue)"/>
  <text x="960" y="240" text-anchor="middle" style="font-size: 13px; fill: #3498DB; font-weight: bold;">
    MySQL
  </text>
  <text x="960" y="255" text-anchor="middle" style="font-size: 11px; fill: #3498DB;">
    Port 3306
  </text>
  
  <!-- Explanation Section -->
  <g transform="translate(50, 420)">
    <text x="0" y="0" class="text-title" style="font-size: 22px;">
      📌 핵심 개념 설명
    </text>
    
    <rect x="0" y="20" width="1300" height="320" style="fill: #F8F9FA; stroke: #DEE2E6; stroke-width: 2;" rx="10"/>
    
    <g transform="translate(20, 50)">
      <text x="0" y="0" style="font-size: 18px; fill: #333; font-weight: bold;">
        1️⃣ 보안 그룹(Security Group)이란?
      </text>
      <text x="0" y="25" class="text-desc" style="font-size: 14px;">
        • AWS의 가상 방화벽입니다. 어떤 트래픽을 허용할지 규칙으로 정의합니다.
      </text>
      <text x="0" y="45" class="text-desc" style="font-size: 14px;">
        • <tspan style="font-weight: bold;">Inbound(인바운드)</tspan>: 외부 → 내부로 들어오는 트래픽 규칙
      </text>
      <text x="0" y="65" class="text-desc" style="font-size: 14px;">
        • <tspan style="font-weight: bold;">Outbound(아웃바운드)</tspan>: 내부 → 외부로 나가는 트래픽 규칙 (기본: 모두 허용)
      </text>
    </g>
    
    <g transform="translate(20, 140)">
      <text x="0" y="0" style="font-size: 18px; fill: #333; font-weight: bold;">
        2️⃣ 소스(Source)란?
      </text>
      <text x="0" y="25" class="text-desc" style="font-size: 14px;">
        • 트래픽이 <tspan style="font-weight: bold;">어디서부터</tspan> 오는지를 지정합니다.
      </text>
      <text x="0" y="45" class="text-desc" style="font-size: 14px;">
        • <tspan style="font-weight: bold;">0.0.0.0/0</tspan>: 인터넷 어디서든 접근 가능 (모든 IP)
      </text>
      <text x="0" y="65" class="text-desc" style="font-size: 14px;">
        • <tspan style="font-weight: bold;">library-alb-sg</tspan>: library-alb-sg 보안 그룹이 붙은 리소스에서만 접근 가능
      </text>
    </g>
    
    <g transform="translate(20, 230)">
      <text x="0" y="0" style="font-size: 18px; fill: #333; font-weight: bold;">
        3️⃣ 트래픽 흐름 (위 다이어그램 참고)
      </text>
      <text x="0" y="25" class="text-desc" style="font-size: 14px;">
        <tspan style="fill: #E74C3C; font-weight: bold;">① 사용자 → ALB</tspan>: 인터넷에서 HTTP/HTTPS로 ALB에 접속 (Port 80, 443)
      </text>
      <text x="0" y="45" class="text-desc" style="font-size: 14px;">
        <tspan style="fill: #FF8C00; font-weight: bold;">② ALB → ECS Tasks</tspan>: ALB가 ECS 앱에 요청 전달 (Port 8081)
      </text>
      <text x="30" y="65" class="text-desc" style="font-size: 13px; font-style: italic;">
        ⚠️ ECS는 library-alb-sg에서 오는 트래픽만 허용! (다른 곳에서는 접근 불가)
      </text>
      <text x="0" y="85" class="text-desc" style="font-size: 14px;">
        <tspan style="fill: #3498DB; font-weight: bold;">③ ECS Tasks → RDS</tspan>: 앱이 데이터베이스에 접속 (Port 3306)
      </text>
      <text x="30" y="105" class="text-desc" style="font-size: 13px; font-style: italic;">
        ⚠️ RDS는 library-ecs-task-sg에서 오는 트래픽만 허용! (다른 곳에서는 접근 불가)
      </text>
    </g>
  </g>
  
  <!-- Footer -->
  <text x="1350" y="790" text-anchor="end" style="font-family: Arial, sans-serif; font-size: 11px; fill: #999;">
    Security Groups Configuration - 2025-10-26
  </text>
</svg>
