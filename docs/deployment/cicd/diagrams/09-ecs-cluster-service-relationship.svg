<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900">
  <!-- Title -->
  <text x="600" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#232F3E">
    ECS Cluster와 Service 상호작용 관계도
  </text>
  <text x="600" y="55" font-size="14" text-anchor="middle" fill="#666">
    Container Orchestration Architecture
  </text>

  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="80" width="300" height="80" fill="#f0f0f0" stroke="#ccc" rx="5"/>
    <text x="60" y="100" font-size="12" font-weight="bold" fill="#333">역할 설명</text>
    <text x="60" y="120" font-size="11" fill="#333">Cluster: 컨테이너 실행 환경 (플랫폼)</text>
    <text x="60" y="140" font-size="11" fill="#333">Service: Task 관리자 (생성/유지/스케일링)</text>
    <text x="60" y="155" font-size="11" fill="#333">Task: 실제 실행되는 컨테이너</text>
  </g>

  <!-- Phase 1: Image Storage (ECR) -->
  <g id="ecr-layer">
    <rect x="50" y="200" width="1100" height="100" fill="#E8F4F8" stroke="#2196F3" stroke-width="2" rx="8"/>
    <text x="70" y="230" font-size="16" font-weight="bold" fill="#0277BD">1. Image Storage Layer (ECR)</text>
    
    <rect x="100" y="245" width="200" height="40" fill="#FFF" stroke="#2196F3" stroke-width="2" rx="5"/>
    <text x="200" y="270" font-size="13" font-weight="bold" text-anchor="middle" fill="#0277BD">ECR Repository</text>
    
    <text x="350" y="260" font-size="12" fill="#333">Docker Image 저장소</text>
    <text x="350" y="278" font-size="11" fill="#666">library-management-system</text>
  </g>

  <!-- Arrow: ECR to Task Definition -->
  <defs>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#2196F3" />
    </marker>
  </defs>
  <path d="M 200 285 L 200 340" stroke="#2196F3" stroke-width="2" fill="none" marker-end="url(#arrowblue)"/>
  <text x="210" y="315" font-size="11" fill="#2196F3" font-weight="bold">참조</text>

  <!-- Phase 2: Task Definition -->
  <g id="task-definition-layer">
    <rect x="50" y="330" width="500" height="120" fill="#FFF8E1" stroke="#FF9800" stroke-width="2" rx="8"/>
    <text x="70" y="360" font-size="16" font-weight="bold" fill="#E65100">2. Task Definition (명세서)</text>
    
    <rect x="100" y="375" width="200" height="55" fill="#FFF" stroke="#FF9800" stroke-width="2" rx="5"/>
    <text x="200" y="395" font-size="12" font-weight="bold" text-anchor="middle" fill="#E65100">Task Definition</text>
    <text x="200" y="410" font-size="10" text-anchor="middle" fill="#666">Container 설정</text>
    <text x="200" y="423" font-size="9" text-anchor="middle" fill="#666">CPU: 512 / Memory: 1024</text>
    
    <rect x="330" y="385" width="190" height="35" fill="#FFECB3" stroke="#FF9800" rx="3"/>
    <text x="340" y="402" font-size="10" fill="#333">Image: ECR URI</text>
    <text x="340" y="415" font-size="10" fill="#333">Port: 8081</text>
  </g>

  <!-- Phase 3: ECS Cluster (Platform) -->
  <g id="cluster-layer">
    <rect x="600" y="200" width="550" height="650" fill="#E8F5E9" stroke="#4CAF50" stroke-width="3" rx="8"/>
    <text x="620" y="230" font-size="18" font-weight="bold" fill="#1B5E20">3. ECS Cluster (실행 환경)</text>
    <text x="620" y="250" font-size="12" fill="#666">library-management-cluster</text>
    <text x="620" y="268" font-size="11" fill="#999">Fargate 기반 플랫폼</text>

    <!-- Inside Cluster: ECS Service -->
    <rect x="630" y="290" width="490" height="530" fill="#FFF" stroke="#66BB6A" stroke-width="2" rx="8"/>
    <text x="650" y="320" font-size="16" font-weight="bold" fill="#2E7D32">ECS Service (관리자)</text>
    <text x="650" y="340" font-size="12" fill="#666">library-service</text>
    
    <!-- Service Responsibilities -->
    <rect x="660" y="360" width="440" height="90" fill="#F1F8E9" stroke="#8BC34A" stroke-dasharray="5,5" rx="5"/>
    <text x="670" y="380" font-size="11" font-weight="bold" fill="#33691E">Service 역할:</text>
    <text x="670" y="398" font-size="10" fill="#333">- Task Definition 기반으로 Task 생성</text>
    <text x="670" y="413" font-size="10" fill="#333">- Desired Count 유지 (자동 재시작)</text>
    <text x="670" y="428" font-size="10" fill="#333">- ALB와 연결 (Target Group 등록)</text>
    <text x="670" y="443" font-size="10" fill="#333">- Rolling Update / Blue-Green 배포 관리</text>

    <!-- Task Instances -->
    <text x="670" y="480" font-size="13" font-weight="bold" fill="#2E7D32">실행 중인 Tasks:</text>
    
    <!-- Task 1 -->
    <rect x="660" y="495" width="200" height="110" fill="#FFF" stroke="#4CAF50" stroke-width="2" rx="5"/>
    <text x="760" y="515" font-size="12" font-weight="bold" text-anchor="middle" fill="#1B5E20">Task 1 (Blue)</text>
    <rect x="675" y="525" width="170" height="70" fill="#E3F2FD" stroke="#2196F3" rx="3"/>
    <text x="760" y="545" font-size="10" font-weight="bold" text-anchor="middle" fill="#0D47A1">Container</text>
    <text x="760" y="560" font-size="9" text-anchor="middle" fill="#333">library-app</text>
    <text x="760" y="573" font-size="9" text-anchor="middle" fill="#666">Port: 8081</text>
    <text x="760" y="586" font-size="9" text-anchor="middle" fill="#666">IP: 10.0.1.45</text>

    <!-- Task 2 -->
    <rect x="890" y="495" width="200" height="110" fill="#FFF" stroke="#4CAF50" stroke-width="2" rx="5"/>
    <text x="990" y="515" font-size="12" font-weight="bold" text-anchor="middle" fill="#1B5E20">Task 2 (Blue)</text>
    <rect x="905" y="525" width="170" height="70" fill="#E3F2FD" stroke="#2196F3" rx="3"/>
    <text x="990" y="545" font-size="10" font-weight="bold" text-anchor="middle" fill="#0D47A1">Container</text>
    <text x="990" y="560" font-size="9" text-anchor="middle" fill="#333">library-app</text>
    <text x="990" y="573" font-size="9" text-anchor="middle" fill="#666">Port: 8081</text>
    <text x="990" y="586" font-size="9" text-anchor="middle" fill="#666">IP: 10.0.2.78</text>

    <!-- Task 3 (Green - for Blue-Green) -->
    <rect x="660" y="625" width="200" height="110" fill="#FFF" stroke="#8BC34A" stroke-width="2" stroke-dasharray="5,5" rx="5"/>
    <text x="760" y="645" font-size="12" font-weight="bold" text-anchor="middle" fill="#558B2F">Task 3 (Green)</text>
    <rect x="675" y="655" width="170" height="70" fill="#FFF9C4" stroke="#FBC02D" rx="3"/>
    <text x="760" y="675" font-size="10" font-weight="bold" text-anchor="middle" fill="#F57F17">Container</text>
    <text x="760" y="690" font-size="9" text-anchor="middle" fill="#333">library-app (new)</text>
    <text x="760" y="703" font-size="9" text-anchor="middle" fill="#666">Port: 8081</text>
    <text x="760" y="716" font-size="9" text-anchor="middle" fill="#666">IP: 10.0.1.92</text>

    <!-- Scaling Info -->
    <rect x="890" y="625" width="200" height="110" fill="#FFF3E0" stroke="#FF9800" stroke-width="2" rx="5"/>
    <text x="990" y="648" font-size="11" font-weight="bold" text-anchor="middle" fill="#E65100">Auto Scaling</text>
    <text x="990" y="668" font-size="9" text-anchor="middle" fill="#333">Desired: 2</text>
    <text x="990" y="683" font-size="9" text-anchor="middle" fill="#333">Minimum: 1</text>
    <text x="990" y="698" font-size="9" text-anchor="middle" fill="#333">Maximum: 4</text>
    <text x="990" y="718" font-size="8" text-anchor="middle" fill="#666">CPU 70% 초과 시 스케일 아웃</text>

    <!-- Service to Task arrow -->
    <path d="M 760 450 L 760 495" stroke="#4CAF50" stroke-width="2" marker-end="url(#arrowgreen)"/>
    <path d="M 990 450 L 990 495" stroke="#4CAF50" stroke-width="2" marker-end="url(#arrowgreen)"/>
    <defs>
      <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L0,6 L9,3 z" fill="#4CAF50" />
      </marker>
    </defs>
    <text x="705" y="475" font-size="10" fill="#4CAF50" font-weight="bold">생성/관리</text>
  </g>

  <!-- Arrow: Task Definition to Service -->
  <path d="M 300 410 L 630 320" stroke="#FF9800" stroke-width="2" marker-end="url(#arroworange)"/>
  <defs>
    <marker id="arroworange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#FF9800" />
    </marker>
  </defs>
  <text x="420" y="360" font-size="11" fill="#FF9800" font-weight="bold">명세서 참조</text>

  <!-- Phase 4: Load Balancer -->
  <g id="alb-layer">
    <rect x="50" y="500" width="500" height="150" fill="#F3E5F5" stroke="#9C27B0" stroke-width="2" rx="8"/>
    <text x="70" y="530" font-size="16" font-weight="bold" fill="#4A148C">4. Application Load Balancer</text>
    
    <rect x="100" y="545" width="180" height="50" fill="#FFF" stroke="#9C27B0" stroke-width="2" rx="5"/>
    <text x="190" y="565" font-size="12" font-weight="bold" text-anchor="middle" fill="#4A148C">ALB</text>
    <text x="190" y="582" font-size="10" text-anchor="middle" fill="#666">library-alb</text>

    <rect x="310" y="545" width="220" height="90" fill="#FCE4EC" stroke="#E91E63" rx="5"/>
    <text x="320" y="565" font-size="11" font-weight="bold" fill="#880E4F">Target Groups:</text>
    <rect x="320" y="575" width="190" height="25" fill="#FFF" stroke="#2196F3" rx="3"/>
    <text x="415" y="592" font-size="10" text-anchor="middle" fill="#0277BD">Blue TG → Task 1, 2</text>
    <rect x="320" y="605" width="190" height="25" fill="#FFF" stroke="#8BC34A" rx="3"/>
    <text x="415" y="622" font-size="10" text-anchor="middle" fill="#558B2F">Green TG → Task 3</text>
  </g>

  <!-- Arrow: ALB to Tasks -->
  <path d="M 420 595 L 760 550" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowblue)"/>
  <text x="550" y="565" font-size="10" fill="#2196F3" font-weight="bold">HTTP 트래픽</text>

  <!-- Phase 5: Users -->
  <g id="users-layer">
    <rect x="50" y="680" width="500" height="100" fill="#FFEBEE" stroke="#F44336" stroke-width="2" rx="8"/>
    <text x="70" y="710" font-size="16" font-weight="bold" fill="#B71C1C">5. External Traffic</text>
    
    <circle cx="150" cy="745" r="20" fill="#FFF" stroke="#F44336" stroke-width="2"/>
    <text x="150" y="752" font-size="18" text-anchor="middle" fill="#F44336">U</text>
    <text x="185" y="752" font-size="12" fill="#333">Users / Internet Traffic</text>
    
    <text x="350" y="745" font-size="11" fill="#666">http://library-alb-xxx.ap-northeast-2.elb.amazonaws.com</text>
  </g>

  <!-- Arrow: Users to ALB -->
  <path d="M 190 745 L 100 570" stroke="#F44336" stroke-width="2" marker-end="url(#arrowred)"/>
  <defs>
    <marker id="arrowred" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#F44336" />
    </marker>
  </defs>
  <text x="95" y="650" font-size="10" fill="#F44336" font-weight="bold">HTTP Request</text>

  <!-- Key Relationships Box -->
  <rect x="50" y="810" width="1100" height="80" fill="#FFF9C4" stroke="#F57C00" stroke-width="2" rx="8"/>
  <text x="70" y="835" font-size="14" font-weight="bold" fill="#E65100">핵심 관계 요약</text>
  <text x="70" y="855" font-size="11" fill="#333">1. Cluster = 빈 플랫폼 / Service = 관리자 / Task = 실행 인스턴스</text>
  <text x="70" y="872" font-size="11" fill="#333">2. Service가 Task Definition을 보고 Cluster 안에 Task를 생성/유지</text>
  <text x="600" y="855" font-size="11" fill="#333">3. ALB가 Service의 Task들로 트래픽 분산</text>
  <text x="600" y="872" font-size="11" fill="#333">4. Blue-Green 배포: Target Group 전환으로 무중단 배포</text>
</svg>