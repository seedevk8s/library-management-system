<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #232F3E; }
      .subtitle { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #232F3E; }
      .text { font-family: Arial, sans-serif; font-size: 14px; fill: #232F3E; }
      .small-text { font-family: Arial, sans-serif; font-size: 12px; fill: #545B64; }
      .box { fill: #FFFFFF; stroke: #232F3E; stroke-width: 2; }
      .ecs-box { fill: #FFE6CC; stroke: #FF9900; stroke-width: 2; }
      .tg-box { fill: #E6F2FF; stroke: #0073BB; stroke-width: 2; }
      .task-box { fill: #E8F8F5; stroke: #17A589; stroke-width: 2; }
      .service-box { fill: #FEF9E7; stroke: #F39C12; stroke-width: 2; }
      .arrow { fill: none; stroke: #545B64; stroke-width: 2; marker-end: url(#arrowhead); }
      .arrow-primary { fill: none; stroke: #FF9900; stroke-width: 3; marker-end: url(#arrowhead-primary); }
      .arrow-auto { fill: none; stroke: #17A589; stroke-width: 2; marker-end: url(#arrowhead-auto); stroke-dasharray: 5,5; }
      .section-bg { fill: #F7F9FA; stroke: #AAB7B8; stroke-width: 1; stroke-dasharray: 5,5; }
      .highlight-bg { fill: #FFF9E6; stroke: #F39C12; stroke-width: 2; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#545B64" />
    </marker>
    <marker id="arrowhead-primary" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#FF9900" />
    </marker>
    <marker id="arrowhead-auto" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#17A589" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" class="title">ECS Service와 Target Group 연결 메커니즘</text>
  <text x="600" y="65" text-anchor="middle" class="small-text">대상 그룹에 ECS Task 자동 등록/해제</text>

  <!-- Section 1: Service Creation Flow -->
  <rect x="50" y="100" width="1100" height="280" class="section-bg" rx="5"/>
  <text x="600" y="130" text-anchor="middle" class="subtitle">1. ECS Service 생성 시 Target Group 연결</text>

  <!-- Step 1 -->
  <rect x="80" y="160" width="200" height="100" class="ecs-box" rx="5"/>
  <text x="180" y="185" text-anchor="middle" class="text" font-weight="bold">ECS Console</text>
  <text x="180" y="205" text-anchor="middle" class="small-text">Clusters > Services</text>
  <text x="180" y="225" text-anchor="middle" class="small-text">→ Create Service</text>
  <text x="180" y="245" text-anchor="middle" class="small-text">클릭</text>

  <!-- Step 2 -->
  <rect x="320" y="160" width="200" height="100" class="service-box" rx="5"/>
  <text x="420" y="185" text-anchor="middle" class="text" font-weight="bold">Service 설정</text>
  <text x="420" y="205" text-anchor="middle" class="small-text">Task Definition 선택</text>
  <text x="420" y="225" text-anchor="middle" class="small-text">Service Name 입력</text>
  <text x="420" y="245" text-anchor="middle" class="small-text">Task 개수 설정</text>

  <!-- Step 3 - Highlighted -->
  <rect x="560" y="150" width="220" height="120" class="highlight-bg" rx="5"/>
  <text x="670" y="180" text-anchor="middle" class="text" font-weight="bold">Load Balancing 설정</text>
  <line x1="570" y1="195" x2="760" y2="195" stroke="#F39C12" stroke-width="1"/>
  <text x="670" y="215" text-anchor="middle" class="small-text">Application Load Balancer</text>
  <text x="670" y="235" text-anchor="middle" class="text" font-weight="bold">Target Group 선택</text>
  <text x="670" y="255" text-anchor="middle" class="small-text">library-blue-tg 또는</text>
  <text x="670" y="270" text-anchor="middle" class="small-text">library-green-tg</text>

  <!-- Step 4 -->
  <rect x="820" y="160" width="200" height="100" class="ecs-box" rx="5"/>
  <text x="920" y="185" text-anchor="middle" class="text" font-weight="bold">Service 생성 완료</text>
  <text x="920" y="205" text-anchor="middle" class="small-text">ECS Service가</text>
  <text x="920" y="225" text-anchor="middle" class="small-text">Target Group과</text>
  <text x="920" y="245" text-anchor="middle" class="small-text">연결됨</text>

  <!-- Arrows between steps -->
  <path d="M 280 210 L 320 210" class="arrow-primary"/>
  <path d="M 520 210 L 560 210" class="arrow-primary"/>
  <path d="M 780 210 L 820 210" class="arrow-primary"/>

  <!-- Important Note -->
  <rect x="80" y="290" width="940" height="70" class="box" rx="5"/>
  <text x="550" y="315" text-anchor="middle" class="text" font-weight="bold">핵심: Target Group은 Phase 3에서 미리 생성, ECS Service가 Phase 4에서 연결</text>
  <text x="550" y="340" text-anchor="middle" class="small-text">Phase 3: 빈 Target Group만 생성 → Phase 4: ECS Service가 Task들을 자동으로 등록</text>

  <!-- Section 2: Auto Registration Mechanism -->
  <rect x="50" y="400" width="550" height="450" class="section-bg" rx="5"/>
  <text x="325" y="430" text-anchor="middle" class="subtitle">2. Task 자동 등록/해제 메커니즘</text>

  <!-- ECS Service -->
  <rect x="80" y="460" width="200" height="80" class="service-box" rx="5"/>
  <text x="180" y="490" text-anchor="middle" class="text" font-weight="bold">ECS Service</text>
  <text x="180" y="510" text-anchor="middle" class="small-text">library-service-blue</text>
  <text x="180" y="527" text-anchor="middle" class="small-text">Desired: 2 Tasks</text>

  <!-- Arrow to TG -->
  <path d="M 280 500 L 320 500" class="arrow-auto"/>
  <text x="290" y="490" class="small-text" font-weight="bold">자동 관리</text>

  <!-- Target Group -->
  <rect x="320" y="460" width="200" height="80" class="tg-box" rx="5"/>
  <text x="420" y="490" text-anchor="middle" class="text" font-weight="bold">Target Group</text>
  <text x="420" y="510" text-anchor="middle" class="small-text">library-blue-tg</text>
  <text x="420" y="527" text-anchor="middle" class="small-text">Registered Targets</text>

  <!-- Task Lifecycle -->
  <rect x="80" y="570" width="460" height="260" class="box" rx="5"/>
  <text x="310" y="600" text-anchor="middle" class="text" font-weight="bold">Task 생명주기와 자동 등록/해제</text>

  <!-- Task Start -->
  <rect x="100" y="620" width="180" height="60" class="task-box" rx="5"/>
  <text x="190" y="645" text-anchor="middle" class="text">Task 시작</text>
  <text x="190" y="665" text-anchor="middle" class="small-text">IP: 10.0.1.100</text>

  <path d="M 280 650 L 330 650" class="arrow-auto"/>
  <text x="295" y="640" class="small-text">자동</text>
  <text x="295" y="655" class="small-text">등록</text>

  <!-- TG Registration -->
  <rect x="330" y="620" width="190" height="60" class="tg-box" rx="5"/>
  <text x="425" y="645" text-anchor="middle" class="text">TG에 등록</text>
  <text x="425" y="665" text-anchor="middle" class="small-text">10.0.1.100:8081</text>

  <!-- Health Check -->
  <rect x="100" y="700" width="180" height="60" class="task-box" rx="5"/>
  <text x="190" y="725" text-anchor="middle" class="text">Health Check</text>
  <text x="190" y="745" text-anchor="middle" class="small-text">Status: Healthy</text>

  <path d="M 280 730 L 330 730" class="arrow"/>
  <text x="295" y="720" class="small-text">상태</text>
  <text x="295" y="735" class="small-text">확인</text>

  <!-- TG Status -->
  <rect x="330" y="700" width="190" height="60" class="tg-box" rx="5"/>
  <text x="425" y="725" text-anchor="middle" class="text">트래픽 수신</text>
  <text x="425" y="745" text-anchor="middle" class="small-text">Ready</text>

  <!-- Task Stop -->
  <rect x="100" y="780" width="180" height="30" class="task-box" rx="5"/>
  <text x="190" y="800" text-anchor="middle" class="small-text">Task 종료 시</text>

  <path d="M 280 795 L 330 795" class="arrow-auto"/>
  <text x="295" y="785" class="small-text">자동</text>
  <text x="295" y="800" class="small-text">제거</text>

  <!-- TG Deregistration -->
  <rect x="330" y="780" width="190" height="30" class="tg-box" rx="5"/>
  <text x="425" y="800" text-anchor="middle" class="small-text">TG에서 제거</text>

  <!-- Section 3: Blue-Green Deployment -->
  <rect x="630" y="400" width="520" height="450" class="section-bg" rx="5"/>
  <text x="890" y="430" text-anchor="middle" class="subtitle">3. Blue-Green 배포 시나리오</text>

  <!-- Blue Environment -->
  <rect x="660" y="460" width="220" height="150" class="service-box" rx="5"/>
  <text x="770" y="485" text-anchor="middle" class="text" font-weight="bold">Blue 환경 (운영중)</text>
  <line x1="670" y1="495" x2="870" y2="495" stroke="#AAB7B8" stroke-width="1"/>
  
  <text x="770" y="515" text-anchor="middle" class="small-text">ECS Service: blue</text>
  <text x="770" y="535" text-anchor="middle" class="small-text">→ library-blue-tg</text>
  <text x="770" y="555" text-anchor="middle" class="small-text">Tasks: 2개</text>
  <text x="770" y="575" text-anchor="middle" class="small-text">Version: v1.0</text>
  <text x="770" y="595" text-anchor="middle" class="text" fill="#17A589">✓ 트래픽 수신중</text>

  <!-- Green Environment -->
  <rect x="660" y="630" width="220" height="150" class="service-box" rx="5"/>
  <text x="770" y="655" text-anchor="middle" class="text" font-weight="bold">Green 환경 (신규)</text>
  <line x1="670" y1="665" x2="870" y2="665" stroke="#AAB7B8" stroke-width="1"/>
  
  <text x="770" y="685" text-anchor="middle" class="small-text">ECS Service: green</text>
  <text x="770" y="705" text-anchor="middle" class="small-text">→ library-green-tg</text>
  <text x="770" y="725" text-anchor="middle" class="small-text">Tasks: 2개</text>
  <text x="770" y="745" text-anchor="middle" class="small-text">Version: v2.0</text>
  <text x="770" y="765" text-anchor="middle" class="text" fill="#F39C12">대기중</text>

  <!-- ALB -->
  <rect x="920" y="520" width="200" height="120" class="ecs-box" rx="5"/>
  <text x="1020" y="550" text-anchor="middle" class="text" font-weight="bold">ALB</text>
  <text x="1020" y="570" text-anchor="middle" class="small-text">리스너 규칙</text>
  <line x1="930" y1="580" x2="1110" y2="580" stroke="#AAB7B8" stroke-width="1"/>
  <text x="1020" y="600" text-anchor="middle" class="small-text">현재: Blue TG</text>
  <text x="1020" y="620" text-anchor="middle" class="small-text">전환 후: Green TG</text>

  <!-- Arrows from Blue/Green to ALB -->
  <path d="M 880 535 L 920 565" class="arrow-primary"/>
  <text x="895" y="545" class="small-text">현재</text>
  
  <path d="M 880 705 L 920 595" class="arrow" stroke-dasharray="5,5"/>
  <text x="895" y="655" class="small-text">전환</text>

  <!-- Deployment Steps -->
  <rect x="660" y="800" width="460" height="30" class="box" rx="5"/>
  <text x="890" y="820" text-anchor="middle" class="small-text" font-weight="bold">배포 순서: Blue 운영 → Green 배포 → Health Check → ALB 전환 → Blue 제거</text>

  <!-- Bottom Legend -->
  <rect x="50" y="870" width="550" height="20" class="box" rx="3"/>
  <text x="60" y="884" class="small-text" font-weight="bold">범례:</text>
  <line x1="110" y1="880" x2="140" y2="880" stroke="#17A589" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="145" y="884" class="small-text">자동 관리 (ECS Service가 수행)</text>
  <line x1="320" y1="880" x2="350" y2="880" stroke="#FF9900" stroke-width="3"/>
  <text x="355" y="884" class="small-text">수동 설정 (사용자가 설정)</text>

</svg>